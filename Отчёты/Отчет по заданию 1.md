# Отчет по Заданию 1

## 1. Анализ Технического Задания и Спецификация Модуля

Разрабатываемый модуль представляет собой **Систему учёта заявок на ремонт климатического оборудования**.

### Краткая Спецификация

| Характеристика | Описание |
| :--- | :--- |
| **Назначение** | Учёт, обработка и контроль выполнения заявок на ремонт климатического оборудования. |
| **Стек** | Python (PyQt6 для интерфейса), PostgreSQL (для хранения данных). |
| **Пользователи** | Заказчик, Специалист, Оператор, Менеджер, Менеджер по качеству, Администратор. |
| **Основной функционал** | Авторизация/Регистрация, Создание/Просмотр/Редактирование заявок, Назначение специалистов, Добавление комментариев, Просмотр статистики, Управление пользователями (для Администратора). |

### Входные и Выходные Данные

| Сущность | Входные данные | Выходные данные |
| :--- | :--- | :--- |
| **Пользователь** | ФИО, Телефон, Логин, Пароль, Роль (присваивается Администратором). | ID, ФИО, Телефон, Логин, Роль. |
| **Заявка** | Тип техники, Модель, Описание проблемы, ID клиента. | ID, Дата создания, Тип/Модель, Статус, ID клиента/мастера, Комментарии. |
| **Статистика** | Запросы к БД по статусам, типам техники, датам. | Общее количество заявок, Количество завершенных, Среднее время ремонта, Статистика по типам оборудования и статусам. |

## 2. Алгоритм Решения (Детализация функции)

В соответствии с ГОСТ 24.301, алгоритм представлен в виде таблицы.

### Алгоритм "Регистрация нового пользователя"

| № п/п | Наименование операции | Условие выполнения | Ссылка на следующий шаг | Примечание |
| :--- | :--- | :--- | :--- | :--- |
| 1 | **Начало** | - | 2 | Запуск диалога регистрации. |
| 2 | **Ввод данных** | Пользователь вводит ФИО, Телефон, Логин, Пароль, Подтверждение пароля. | 3 | - |
| 3 | **Проверка заполнения** | Все обязательные поля заполнены? | Да: 4; Нет: 10 | - |
| 4 | **Проверка совпадения паролей** | Пароль совпадает с Подтверждением пароля? | Да: 5; Нет: 11 | - |
| 5 | **Проверка длины пароля** | Длина Пароля >= 4 символов? | Да: 6; Нет: 12 | - |
| 6 | **Присвоение роли** | - | 7 | Автоматическое присвоение роли "Заказчик". |
| 7 | **Добавление пользователя в БД** | Логин уникален? | Да: 8; Нет: 13 | Хеширование пароля перед записью. |
| 8 | **Успешная регистрация** | - | 9 | Вывод сообщения об успешной регистрации. |
| 9 | **Конец** | - | - | Закрытие диалога. |
| 10 | **Ошибка: Незаполненные поля** | - | 2 | Вывод предупреждения "Пожалуйста, заполните все поля!". |
| 11 | **Ошибка: Пароли не совпадают** | - | 2 | Вывод предупреждения "Пароли не совпадают!". |
| 12 | **Ошибка: Короткий пароль** | - | 2 | Вывод предупреждения "Пароль должен содержать минимум 4 символа!". |
| 13 | **Ошибка: Логин занят** | - | 2 | Вывод предупреждения "Пользователь с таким логином уже существует!". |

### Детализация функции "Расчет статистики по статусам заявок"

В качестве детализированного алгоритма выбрана функция **"Расчет статистики по статусам заявок"** (реализована в `database_module.py` как часть `get_statistics`).

**Цель:** Получить количество заявок для каждого статуса (например, "Новая заявка", "В процессе ремонта", "Готова к выдаче").

В качестве детализированного алгоритма выбрана функция **"Расчет статистики по статусам заявок"** (реализована в `database_module.py` как часть `get_statistics`).

**Цель:** Получить количество заявок для каждого статуса (например, "Новая заявка", "В процессе ремонта", "Готова к выдаче").

| Шаг | Действие | Условие | Результат |
| :--- | :--- | :--- | :--- |
| 1 | **Инициализация** | Соединение с БД установлено. | Запуск функции `get_statistics`. |
| 2 | **Запрос к БД** | Выполнить SQL-запрос: `SELECT request_status, COUNT(*) FROM requests GROUP BY request_status`. | Получение набора данных (статус, количество). |
| 3 | **Обработка** | Итерация по полученному набору данных. | Формирование списка словарей `stats['by_status']`. |
| 4 | **Формат** | Каждый элемент списка: `{'status': [статус], 'count': [количество]}`. | Готовый список статистики по статусам. |
| 5 | **Возврат** | Все статистические данные собраны. | Возврат словаря `stats` в вызывающую функцию (`load_statistics` в `main_app.py`). |

## 3. Разработка Интерфейса и Реализация

### Интерфейс (PyQt6)

Интерфейс разработан с использованием библиотеки **PyQt6**, что обеспечивает нативный вид и согласованность.

*   **Единый стиль:** Применены CSS-стили для обеспечения единого внешнего вида всех компонентов (кнопки, вкладки, поля ввода).
*   **Последовательность:** Использование `QTabWidget` для навигации между основными разделами ("Все заявки", "Статистика", "Пользователи").
*   **Заголовки:** Каждое окно (диалог) и вкладка имеют соответствующий заголовок.

### Реализация Алгоритма и Код

*   **Язык:** Python.
*   **Соглашение об именовании:** Используется стиль `snake_case` (например, `load_statistics`, `add_user`), соответствующий гайдлайнам Python (PEP 8).
*   **Обработка исключений:** Реализована в модуле `database_module.py` с использованием конструкции `try...except Error` для обработки ошибок PostgreSQL.
*   **Уведомления пользователя:** Используется `QMessageBox` для:
    *   Предупреждения о незаполненных полях.
    *   Сообщения об ошибках (например, неверный логин/пароль).
    *   Запроса подтверждения (например, перед удалением пользователя).

## 4. Отладка и Функциональное Тестирование

### Отладка

Отладка проводилась в процессе разработки. Последние исправления касались:
1.  Удаления возможности выбора роли при регистрации.
2.  Добавления функционала смены роли Администратором.
3.  Исправления визуального отклика кнопки "Обновить статистику".

### Протокол Тестирования (Пример)

| ID Теста | Функция | Сценарий | Ожидаемый результат | Фактический результат | Статус |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **T1.1** | Регистрация | Регистрация нового пользователя с корректными данными. | Пользователь успешно добавлен с ролью "Заказчик". | Успешно | **Пройден** |
| **T1.2** | Авторизация | Ввод неверного пароля. | Вывод сообщения "Неверный логин или пароль!". | Успешно | **Пройден** |
| **T1.3** | Создание заявки | Заказчик создает новую заявку. | Заявка появляется в списке со статусом "Новая заявка". | Успешно | **Пройден** |
| **T1.4** | Смена роли | Администратор меняет роль "Заказчик" на "Специалист". | Роль пользователя в таблице обновляется на "Специалист". | Успешно | **Пройден** |
| **T1.5** | Статистика | Нажатие кнопки "Обновить статистику". | Текстовое поле статистики обновляется актуальными данными из БД. | Успешно | **Пройден** |
